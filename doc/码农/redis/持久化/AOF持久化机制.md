1.AOF本质是保存的redis的命令  因为redis的命令协议是纯文本协议 所以可以直接打开AOF文件进行查看



2.AOF持久化功能的实现步骤：命令追加->文件写入->文件同步(sync)
  命令追加 在服务器结构体中有个AOF的缓冲区 表示每执行完一条命令后会将被执行的命令追加到服务器状态的aof_buf的缓冲区的末尾
  文件写入  文件写入内存缓冲区
  文件同步  文件同步到磁盘
  

3.AOF文件的载入与还原
   因为AOF文件保存的就是redis的所有命令 那么只要重新执行一遍命令即可保证还原 
   需要注意的是因为redis的命令只有在redis的客户端的上下文中执行 所以redis服务器会创建一个不带网络连接的伪客户端 


4.AOF文件的重写机制
  因为AOF文件不同于RDB文件 RDB文件只是保存了redis的快照信息  而AOF文件保存的是所有的命令 不可避免的是文件的膨胀 为了解决这个问题引入AOF文件的重写机制
  并且AOF文件的重写机制的原理很简单 就是读取redis服务器内存 然后生成一条命令来记录键值对的值 用到的函数是aof_rewrite()
  疑问？
   这个AOF的文件重新机制是采用子进程进行的？为什么不采用多线程进行？
  由于是并发的 所以会产生一个问题 就是数据库状态和重写后的AOF保存的数据库状态不一致
  
  怎么解决这个数据不一致的问题？再搞一个重写缓冲区
  redis在执行BGREWRITEAOF命令的时候 redis服务器会维护一个AOF的重写缓冲区 该缓冲区会在执行子进程创建新AOF文件的时候记录服务器的所有写命令 当子进程完成
  创建新的AOF文件的工作后 服务器将重新缓冲区的所有内容追加到新的AOF文件的末尾 使得新旧两个文件所保存的数据库状态一致 最后服务器用新的AOF替换旧的AOF文件即可
  